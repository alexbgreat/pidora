<!doctype html>
<html lang="en-GB">
<head>
	<title>Pidora | Mobile</title>
	<meta name="description" content="Pidora mobile site - Full web control of Pianobar" />
	<link rel="icon" type="image/png" href="imgs/favicon.ico">
	<meta name="HandheldFriendly" content="true" />
	<meta name="viewport" content="width=device-width, height=device-height, user-scalable=yes" />
	<meta name="robots" content="index, follow" />
	<link rel=stylesheet href=css/mobile.css />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.js"></script>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.4/jquery.mobile-1.4.4.min.css">
	<script>
	function update_song(){
		$.ajax({
			url:'/api',
			data:'json='+encodeURIComponent('{"method":"GetSongInfo","id":1}'),
			method:"get",
			dataType:"json",
			success:function(data){
				var title = data.song.title
				if(data.song.loved){
					title = title + " <3"
				}
				$("#title").text(title);
				$("#artist").text(data.song.artist);
				$("#album").text(data.song.album);
				$("#albumart").attr("src",data.song.artURL);
				$('option:contains("'+data.song.station_name+'")', 'select[name=stationselect]')[0].selected = true

			}
		});
	}
	jQuery(document).ready(function () {
	update_song()
	setInterval('update_song()', 5000);
	});

$(function(){
  $(".btn").live('click', function() {
      this.src = this.src.replace("_off","_on");
      setTimeout(function(t){
      	t.src = t.src.replace("_on","_off")},400,this);
      setTimeout(update_song(),1000);
  })

  });
</script>
</head>
<body>
<div data-role="header" id="header">
	<select name="stationselect">
		<option>Choose a station</option>
	</select>
</div>
<div class="colmask fullpage">
	<div class="col1">
	<!-- Column 1 start -->
	<div class="displayed">

	<div id="title">{SONGTITLE} {LOVED}</div>
	<div id="artist">{SONGARTIST}</div>
	<div id="album">{SONGALBUM}</div>
	<img class="displayed" id="albumart" src="" width="250" height="250" alt="" />
	
	<div class="spacer"></div>
	
</div>
</div>
<div data-role="footer" data-position="fixed">
	<div data-role="navbar" data-id="controlbar" data-tap-toggle="false" class="controlbar">
	<p><img class="btn" src="/imgs/pause_off.png" onclick="$.ajax('/mobile?c=pause')"/>
	    <img class="btn" src="/imgs/next_off.png" onclick="$.ajax('/mobile?c=next')"/> 
	    <img class="btn" src="/imgs/love_off.png" onclick="$.ajax('/mobile?c=love')"/> 
	    <img class="btn" src="/imgs/ban_off.png" onclick="$.ajax('/mobile?c=ban')"/> 
	    <img class="btn" src="/imgs/tired_off.png" onclick="$.ajax('/mobile?c=tired')"/> 
	    <br/>
		<img class="btn" src="/imgs/volup_off.png" onclick="$.ajax('/mobile?c=volumeup')"/> 
		<img class="btn" src="/imgs/voldn_off.png" onclick="$.ajax('/mobile?c=volumedown')"/>
	</p>
	</div>

	<!-- Column 1 end -->
    </div>
<!-- http://github.com/jacroe/pidora Pidora by jacroe -->
<script type="text/javascript">
	$(document).ready(function()
	{
		getStations(0);
		$('select[name=stationselect]').change(function()
		{
			var id = $('select[name=stationselect]').val();
			$.get("api", {json:JSON.stringify({"method":"ChangeStation", "id":1, "stationID":id})}).done(function()
				{
					window.setTimeout(update_song(), 1000);
				});
		});
	});

	function getStations(index)
	{
		$.get("api", {json:JSON.stringify({"method":"GetStationData", "id":1, "index":index})}).done(function(stationList)
		{
			stationList = stationList.stationData;
			for(var i = 0; i < stationList.stations.length; i++)
			{
				$('select[name=stationselect]')
					.append($('<option>', { value : index.toString() + i.toString() }).text(stationList.stations[i]));
			}
			if(stationList.next != null)
				getStations(index+1);
		});
	}

	function explainSong()
	{
		switch(1)
		{
			case 1:
				$.get("api", {json:JSON.stringify({"method":"GetExplanation", "id":1})}).done(function(explain)
				{
					alert(explain.explanation);
				});
				break;
			case 2:
				alert("How can you expect an explanation when there's nothing playing? You're being silly.");
				break;
			case 3:
				alert("There does not exist an appropriate explanation for this track. Sorry about that.");
				break;
		}
	}
</script>
</body>
</html>